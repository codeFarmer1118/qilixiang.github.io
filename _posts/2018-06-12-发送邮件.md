---
layout:     post
title:      发送邮件
subtitle:   SendEmailUtil
date:       2018-06-12
author:     Static
header-img: img/bg/sendEmail.jpg
catalog: true
tags:
    - send email
---

### 利用Apache的commons-email-1.4.jar实现发送邮件的功能

#### 1. 首先需要依赖的jar包

```
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-email</artifactId>
    <version>1.4</version>
</dependency>
        
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.16.18</version>
</dependency>
```

#### 2. 添加发送邮件的工具类，简单的封装了下

```
package com.fxiaoke.util;

import lombok.Getter;
import lombok.Setter;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.mail.EmailException;
import org.apache.commons.mail.SimpleEmail;

import java.text.SimpleDateFormat;
import java.util.Date;

/**
 * Created by wangzhx on 2018/6/11.
 */
@Slf4j
public class SendEmail {
    //主机服务
    private static String HOSTNAME = "smtp.163.com";

    public static void toWho(String toEmail, String nickName, String title, String content) {
        SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyy-MM-dd HH:mm:ss");
        StringBuilder msgInfo = new StringBuilder();
        msgInfo.append(content).append("\r\n\t");
        msgInfo.append("时间：").append(simpleDateFormat.format(new Date()));

        try {
            SimpleEmailSingleton.INSTANCE
                    .setHostName(HOSTNAME)
                    .setAuthentication(FromUser.USER.getUserName(), FromUser.USER.getPassword())
                    .setCharset("UTF-8")
                    .addTo(toEmail)
                    .setFrom(FromUser.USER.getUserName(), nickName)
                    .setSubject(title + "-" + simpleDateFormat.format(new Date()))
                    .setMsg(msgInfo.toString())
                    .send();
            log.info("发送人:{},收件人:{},发送邮箱成功", FromUser.USER.getUserName(), toEmail);
        } catch (EmailException e) {
            log.error("发给{}邮件失败", toEmail);
            throw new RuntimeException("发送邮箱失败！");
        }
    }

    enum SimpleEmailSingleton {
        INSTANCE;

        private static final SimpleEmail simpleEmail = new SimpleEmail();

        SimpleEmailSingleton setHostName(String hostName) {
            simpleEmail.setHostName(hostName);
            return this;
        }

        SimpleEmailSingleton setAuthentication(String userName, String password) {
            simpleEmail.setAuthentication(userName, password);
            return this;
        }

        SimpleEmailSingleton setCharset(String newCharset) {
            simpleEmail.setCharset(newCharset);
            return this;
        }

        SimpleEmailSingleton addTo(String email) throws EmailException {
            simpleEmail.addTo(email);
            return this;
        }

        SimpleEmailSingleton setFrom(String email, String name) throws EmailException {
            simpleEmail.setFrom(email, name);
            return this;
        }

        SimpleEmailSingleton setSubject(String aSubject) {
            simpleEmail.setSubject(aSubject);
            return this;
        }

        SimpleEmailSingleton setMsg(String msg) throws EmailException {
            simpleEmail.setMsg(msg);
            return this;
        }

        SimpleEmailSingleton send() throws EmailException {
            simpleEmail.send();
            return this;
        }
    }

    enum FromUser {
        //邮箱账号,授权码
        USER("whvixd@163.com", "******");

        @Setter
        @Getter
        private String userName;

        @Setter
        @Getter
        private String password;

        FromUser(String userName, String password) {
            this.userName = userName;
            this.password = password;
        }
    }

}

```

#### 3. 测试发送邮箱

```
package com.fxiaoke;

import com.fxiaoke.util.SendEmail;

/**
 * Created by wangzhx on 2018/3/29.
 */
public class Test {

    @org.junit.Test
    public void sendEmail() {
        SendEmail.toWho("***@***.com",
                "七里香", "Title",
                "1. qilixiang test send email");
    }

}

```

**最后成功收到邮件**

![目录结构](/img/SendEamil/email1.png)

> 注意：若使用163邮箱作为发送人，要在163的个人首页中设置授权码(用于登录第三方邮件客户端的专用密码)

![目录结构](/img/SendEamil/163_1.jpg)

![目录结构](/img/SendEamil/163_2.jpg)